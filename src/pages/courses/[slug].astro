---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCourse, listCourseSlugs } from "../../lib/courses";

export async function getStaticPaths() {
  const slugs = listCourseSlugs();
  return slugs.map((slug) => ({
    params: { slug },
  }));
}

const { slug } = Astro.params;
const course = await getCourse(String(slug));
if (!course) {
  throw Astro.redirect("/courses/");
}

const { Content } = course;
const priceFormatter = new Intl.NumberFormat("en-US", {
  style: "currency",
  currency: "USD",
  minimumFractionDigits: 0,
});

const priceDisplay =
  typeof course.price === "number" ? priceFormatter.format(course.price) : null;
---

<BaseLayout title={`${course.title} â€“ Course`}>
  <main class="mx-auto max-w-6xl px-4 md:px-0 py-10">
    <article class="space-y-12">
      <header class="space-y-8">
        <div
          class="relative overflow-hidden rounded-3xl bg-foreground/80 pb-10 pt-40 text-white"
        >
          <img
            src={course.cover ?? "/images/wave-001.png"}
            alt=""
            class="pointer-events-none absolute inset-0 h-full w-full object-cover"
            loading="lazy"
            aria-hidden="true"
          />
          <div class="relative space-y-4 px-6 md:px-10">
            <h1
              class="bg-black/80 p-4 text-4xl font-mono uppercase tracking-[0.2em] md:text-5xl w-fit"
            >
              {course.title}
            </h1>
            {course.excerpt && (
              <p
                class="italic max-w-2xl bg-black/80 px-4 py-3 text-[16px] leading-7 text-white/90 w-fit"
              >
                {course.excerpt}
              </p>
            )}
          </div>
        </div>
      </header>
      <div class="mt-8 flex flex-col-reverse gap-10 lg:flex-row">
        <aside
          class="space-y-4 self-start rounded-2xl border border-foreground/10 bg-background-alt/40 p-6 shadow-sm lg:sticky lg:top-24 lg:w-72 lg:flex-shrink-0"
        >
          <div class="space-y-3">
            <h2
              class="text-sm font-semibold uppercase tracking-[0.2em] text-foreground/60"
            >
              Course Details
            </h2>
            <dl class="space-y-4 text-sm text-foreground/80">
              {course.level && (
                <div class="flex flex-col gap-1">
                  <dt class="text-xs uppercase tracking-[0.2em] text-foreground/40">
                    Level
                  </dt>
                  <dd>{course.level}</dd>
                </div>
              )}
              {course.duration && (
                <div class="flex flex-col gap-1">
                  <dt class="text-xs uppercase tracking-[0.2em] text-foreground/40">
                    Duration
                  </dt>
                  <dd>{course.duration}</dd>
                </div>
              )}
              {priceDisplay && (
                <div class="flex flex-col gap-1">
                  <dt class="text-xs uppercase tracking-[0.2em] text-foreground/40">
                    Price
                  </dt>
                  <dd>{priceDisplay}</dd>
                </div>
              )}
              <div class="flex flex-col gap-1">
                <dt class="text-xs uppercase tracking-[0.2em] text-foreground/40">
                  Reading Time
                </dt>
                <dd>{course.readingMinutes} min</dd>
              </div>
              {course.tags && course.tags.length > 0 && (
                <div class="flex flex-col gap-2">
                  <dt class="text-xs uppercase tracking-[0.2em] text-foreground/40">
                    Tags
                  </dt>
                  <dd>
                    <ul class="flex flex-wrap gap-2 text-[11px] uppercase tracking-[0.2em] text-foreground/60">
                      {course.tags.map((tag) => (
                        <li class="rounded-full border border-foreground/15 px-3 py-1">
                          {tag}
                        </li>
                      ))}
                    </ul>
                  </dd>
                </div>
              )}
            </dl>
          </div>
        </aside>
        <div
          class="prose-wrapper mx-auto max-w-3xl space-y-6 text-[15px] leading-7 text-foreground/80 [&_strong]:text-foreground lg:mx-0 lg:flex-1"
        >
          <div
            class="space-y-6 font-serif text-foreground"
            data-heading-scope
            data-heading-variant="mono"
          >
            <Content />
          </div>
        </div>
      </div>
    </article>
  </main>
</BaseLayout>
