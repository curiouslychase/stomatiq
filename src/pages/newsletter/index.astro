---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getAllPostsMeta } from "../../lib/posts";

const posts = getAllPostsMeta();
const dateFormatter = new Intl.DateTimeFormat("en-US", {
  month: "short",
  day: "numeric",
  year: "numeric",
});
const formatDate = (value: string) => {
  const parsed = new Date(value);
  return Number.isNaN(parsed.getTime()) ? value : dateFormatter.format(parsed);
};
---

<BaseLayout title="Newsletter">
  <main class="mx-auto max-w-6xl px-4 md:px-6 py-10">
    <h1 class="text-3xl font-semibold tracking-tight">Newsletter</h1>
    <p class="mt-3 text-[15px] leading-7 text-foreground/70">
      Essays and updates on product, engineering, and AI at Stomatiq.
    </p>

    {posts.length ? (
      <ul class="mt-8 space-y-6">
        {posts.map((post) => (
          <li class="rounded-lg border border-foreground/10 transition hover:border-foreground/20">
            <a
              href={`/newsletter/${post.slug}/`}
              class="block p-6 no-underline"
            >
              <time class="text-xs uppercase tracking-wide text-foreground/60">
                {formatDate(post.date)}
              </time>
              <h2 class="mt-2 text-xl font-semibold tracking-tight">
                {post.title}
              </h2>
              {post.excerpt && (
                <p class="mt-3 text-sm leading-6 text-foreground/70">
                  {post.excerpt}
                </p>
              )}
              <span class="mt-4 inline-flex items-center text-sm font-medium text-foreground">
                Read essay
                <svg
                  class="ml-2 h-4 w-4"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M5 12h14" />
                  <path d="m13 6 6 6-6 6" />
                </svg>
              </span>
            </a>
          </li>
        ))}
      </ul>
    ) : (
      <p class="mt-8 text-sm text-foreground/60">No posts published yet.</p>
    )}
  </main>
</BaseLayout>
