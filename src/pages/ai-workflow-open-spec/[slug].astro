---
import BaseLayout from "../../layouts/BaseLayout.astro";
import {
  getAllSpecSectionsMeta,
  getSpecSection,
} from "../../lib/spec";

export async function getStaticPaths() {
  const sections = getAllSpecSectionsMeta();
  return sections.map((section) => ({
    params: { slug: section.slug },
  }));
}

const { slug } = Astro.params;
const section = await getSpecSection(String(slug));
if (!section) {
  return Astro.redirect("/ai-workflow-open-spec/");
}

const sections = getAllSpecSectionsMeta();
const pageTitle = `AI Workflow Open Spec â€“ ${section.title}`;
---

<BaseLayout title={pageTitle}>
  <main class="mx-auto flex w-full max-w-6xl flex-col gap-10 px-4 py-10 lg:flex-row lg:px-6">
    <aside class="lg:w-72 lg:flex-shrink-0">
      <h2 class="text-sm font-semibold uppercase tracking-[0.2em] text-foreground/60">
        Specification Sections
      </h2>
      <ol class="mt-4 space-y-2 text-sm">
        {sections.map((item, index) => (
          <li>
            <a
              href={`/ai-workflow-open-spec/${item.slug}/`}
              class={`flex items-start gap-3 rounded-md px-3 py-2 transition hover:bg-foreground/5 ${item.slug === section.slug ? "bg-foreground/10 font-semibold" : "bg-transparent"}`}
            >
              <span class="text-xs font-mono uppercase tracking-widest text-foreground/60">
                {String(index + 1).padStart(2, "0")}
              </span>
              <span class="text-left leading-5">{item.title}</span>
            </a>
          </li>
        ))}
      </ol>
    </aside>

    <article class="prose-wrapper flex-1">
      <header class="border-b border-foreground/10 pb-6">
        <h1 class="text-3xl font-semibold tracking-tight">{section.title}</h1>
        <p class="mt-3 text-[15px] leading-7 text-foreground/70">
          Part of the AI Workflow Open Specification.
        </p>
      </header>
      <div
        class="mt-8 space-y-6 text-[15px] leading-7 text-foreground/80 [&_strong]:text-foreground"
        set:html={section.contentHtml}
      />
    </article>
  </main>
</BaseLayout>
